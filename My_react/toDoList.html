<!DOCTYPE html>
<html>
<head>
    <title>To Do List</title>
    <meta charset="utf-8">
    <style>
        .toDoList {
            padding: 0;
        }
        .toDoList_createBtn:not([disabled]) {
            cursor: pointer;
        }
        .toDoList_task {
            list-style-type: none;
            display: flex;
            align-items: center;
        }
        .toDoList_check {
            display: block;
            margin: 0 5px 0 0;
            cursor: pointer;
        }
        .toDoList_check:checked + .toDoList_label {
            text-decoration: line-through;
        }
        .toDoList_label {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="app">
    <!-- my app renders here -->
</div>
<script src="../chapters/react/build/react.js"></script>
<script src="../chapters/react/build/react-dom.js"></script>
<script>
    var PageTitle = React.createClass({
        displayName: 'PageTitle',
        render: function () {
            return React.DOM.h1(
                {id: 'toDoList_title'},
                document.querySelector('title').textContent
            )
        }
    });

    var ToDoList = React.createClass({
        displayName: 'ToDoList',
        render: function () {
            return React.DOM.div(
                {id: 'toDoList'},
                React.createElement(PageTitle),
                React.createElement(ToDoListCreateBlock)
            );
        }
    });

    var ToDoListCreateBlock = React.createClass({
        displayName: 'ToDoListCreateBlock',
        getDefaultProps: function () {
            return {
                taskName: '',
                tasksList: []
            }
        },
        getInitialState: function () {
            return {
                taskName: this.props.taskName,
                tasksList: this.props.tasksList
            }
        },
        _textChange: function (ev) {
            this.setState({
                taskName: ev.target.value
            })
        },
        _createTask: function () {
            this.props.tasksList.push(this.state.taskName);
            this.setState({
                tasksList: this.props.tasksList
            })
        },
        _isDisabled: function () {
            return !this.state.taskName.length;
        },
        render: function () {
            var createBtn;
            var taskNodes = [];
            var tasks = this.state.tasksList;
            var isDisabled = this._isDisabled();

            if (tasks.length > 0) {
                tasks.map(function (task, idx) {
                    taskNodes.push(React.createElement(ToDoListTask, {task: task, key: idx}))
                });
            }

            createBtn = React.DOM.input({
                type: 'button',
                value: 'Create new task',
                className:'toDoList_createBtn',
                disabled: isDisabled,
                onClick: this._createTask
            });

            return React.DOM.div(
                {className: 'toDoList_wrapper'},
                React.DOM.input({
                    type: 'text',
                    taskName: this.state.taskName,
                    onChange: this._textChange
                }),
                createBtn,
                React.DOM.ul(
                    {className: 'toDoList'},
                    taskNodes
                )
            )
        }
    });

    var ToDoListTask = React.createClass({
        displayName: 'ToDoListTask',
        getDefaultProps: function () {
            return {
               className: 'toDoList_task'
            }
        },
        getInitialState: function () {
            return {
                className: this.props.className
            }
        },
        _taskCheck: function (ev) {
            var isChecked = ev.target.checked;
            var newClassName = this.props.className;
            
            if (isChecked) {
                newClassName += ' ' + 'is-Selected';
            }
            this.setState({
                className: newClassName
            })
        },
        render: function () {
            return React.DOM.li(
                {
                    onChange: this._taskCheck,
                    className: this.state.className
                },
                React.createElement(ToDoListCheckBox, {task: this.props.key}),
                React.DOM.label(
                    {
                        className: 'toDoList_label',
                        htmlFor: this.props.key
                    },
                    this.props.task
                )
            )
        }
    });

    var ToDoListCheckBox = React.createClass({
        displayName: 'ToDoListCheckBox',
        render:      function () {
            return React.DOM.input(
                {id: this.props.key, className: 'toDoList_check', type: 'checkbox'}
            );
        }
    });

    ReactDOM.render(
        React.createElement(ToDoList),
        document.getElementById("app")
    );
</script>
</body>
</html>
